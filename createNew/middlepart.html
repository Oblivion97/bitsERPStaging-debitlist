<div class="container-center-new" style="min-height: calc(100vh - 105px); margin-bottom: 17px;">
    <div id="layout-body-ajax" class="sbi-layout-body-container">
        <div id="pageContent">

<script type="text/javascript" language="Javascript">
var paymentRowId, voucherRowId = null, mrowId, programTypeSelectedId = '';
var accReconCodeListWithCriteria;
var accReconCodeListWithCriteriaTransfer;
var accReconCodeListWithCriteriaReceive;

var fileFormat;
var isHeadOffice = false;
var toProjectFlag = false, areaCodeByProject = false;

var isEditMode = false;
var isSubmitted = '';
var currentBranchOverHeadProject;
var chequeDetailsColumns, mobilePaymentDetailsColumns, voucherDetailColumns;
var objSB = null, overHeadFlag = false;
var objBankGridData, objMobileGridData;
var cahoId = null;

var enumsPaymentType = {};


enumsPaymentType['CASH'] = 'Cash';



enumsPaymentType['BANK'] = 'Bank';



enumsPaymentType['MOBILE_BANKING'] = 'Mobile Banking';



var employeeId = '638';
var enumsProgramType = {};

enumsProgramType['C000'] = 'Consolidate';

enumsProgramType['C001'] = 'Non-Microfinance';

enumsProgramType['C002'] = 'Microfinance';

enumsProgramType['ENT'] = 'Enterprise';




var MENU_URL = 'creditVoucher/createCreditVoucher';
var PAYMENT_SUB_TYPE_LIST_URL = '/node/accPaymentSubType/getPaymentSubTypeList';
var ISSUE_DEBIT_VOUCHER_SAVE_URL = '/node/accJournalMaster/saveIssueDebitVoucher';
var DELETE_DEBIT_VOUCHER_URL = '/node/accJournalMaster/deleteDebitVoucher';
var PAYMENT_BANK_CODE = "BANK";
var PAYMENT_CASH_CODE = "CASH";
var PAYMENT_MOBILE_CODE = "MOBILE_BANKING";
var OFFICE_TYPE_HO = 'HO';

$(document).ready(function () {

initForm();
setOnChange();

if (isEditMode) {
//EDIT MODE

$('#debitTitle').text('Update Debit Voucher');
$('#description').val(objSB.debitVoucherList.description);
$('#ref').val(objSB.debitVoucherList.reference);

if (objSB.debitVoucherList.attachment_file_path) {
    var attachmentFile = objSB.debitVoucherList.attachment_file_path;
    var lastslashindex = attachmentFile.lastIndexOf('/');
    var result = attachmentFile.substring(lastslashindex + 1);
    jQuery("label[id='fileName']").html(result);
}
$('#paytoNameTxt').val(objSB.debitVoucherList.pay_to_name);
$("#remarksp").val('Paid To ' + objSB.debitVoucherList.pay_to_name + ' against');
voucher.enumsDropDown(enumsPaymentType, '#paymentType', objSB.debitVoucherList.payment_type, null, false, 'Select Receive Type');

if (objSB.debitVoucherList.payment_type === PAYMENT_BANK_CODE) {
    objBankGridData = voucher.getAjaxResponse('accJournalMaster/getDebitVoucherListById', {journalMasterId: ''}, false);
    doTable("#paymentDetailTable", chequeDetailsColumns, objBankGridData.paymentDetails, 'add');
} else if (objSB.debitVoucherList.payment_type === PAYMENT_MOBILE_CODE) {
    objMobileGridData = voucher.getAjaxResponse('accJournalMaster/selectMobileDetails', {journalMasterId: ''}, false);
    doTable("#mobilePaymentDetailsGrid", mobilePaymentDetailsColumns, objMobileGridData.paymentDetails, 'add');
} else {
    $('#cashAmount').val(objSB.debitVoucherList.cash_amount);
    changeCashAmountToText(objSB.debitVoucherList.cash_amount);
}
doTable("#issuDebitVoucherDetailTable", voucherDetailColumns, objSB.accDebitDetails, 'add');
} else {

initializeComponentsForCreate();
clearAndInitSelectList('#toProject', "-Select Project-");
voucher.hideDOM("#toProjectWrap", "#reconCodeWrap", "#toBranchWrap", "#warp_areaCode");
}


$('#entityDiv').hide();
if (isEditMode) {
voucher.showDOM('#delete', '#submit', '#saveUpdate');
voucher.hideDOM('#saveAndSubmit', '#save', '#cancel1', '#updateGridVoucherDetails', '#updateGridPaymentDetails');

//organization fixme
voucher.initializeElementWithValue({
    '#voucher_no': '',
    '#organizationBranch': ''
});

if (objSB && objSB.debitVoucherList.status === 'Approved') {
    voucher.hideDOM("#saveOptions", "#detailsButton", "#mobileButtons", "#bankButtons");
    voucher.readOnly("#paytoType", "#paymentType", "#paymentSubType", "#bankAccount", "#mobilePaymentSubType",
        "#projectName", "#chartOfAccounts", "#subLedger", "#entityId", "#reconCode", "#toBranch", "#toProject");
}

} else {
voucher.hideDOM('#delete', '#saveUpdate');
voucher.showDOM('#saveAndSubmit', '#save', '#cancel1');
}
});

function initForm() {
$("#paymentType option[value='MOBILE_BANKING']").attr('disabled','disabled');
var programType = voucher.getDefaultProgramType('C002');
voucher.enumsDropDown(enumsProgramType, '#programType', programType, ['C000'], true, 'Select Category');
$('#programType').select2("readonly", true);

var response = voucher.getAjaxResponse('costCenter/getCostCenterListAndProjectByOrganization',
{
    programType: programType
}, false
);
currentBranchOverHeadProject = response.overHeadProj;

copyPasteStringRestrict('.pastedString');
fileFormat = 'pdf,doc,docx,xls,csv';
voucher.reconCodeDropDown('#reconCode', null, null, 'Select ReconCode', true, {recon_code_type:'RECEIVE'},
'reconCodeDropDownSuccess');
voucher.reconCodeDropDown('#reconCode', null, null, 'Select ReconCode', true, {recon_code_type:'TRANSFER'},
'reconCodeDropDownSuccess');


voucher.hideDOM("#reconCodeWrap", "#warp_areaCode", "#toProjectWrap", "#toBranchWrap");
voucher.datePickerInitialize(".date-picker", ".cheque-date-picker");
$('#paytoType').select2();
$("#dateOfCreation").val($("#sessionBusinessDate").val());
//initializing grids
initPopulateMobileDetailsGrid();
initializeDetailsTables();
}

function initializeComponentsForCreate() {

isHeadOffice = ($('#sessionOfficeTypeCode').val() === OFFICE_TYPE_HO) ? true : false;
if (isHeadOffice) {
$("#paymentType").select2().select2('val', PAYMENT_BANK_CODE);
showBankDiv(PAYMENT_BANK_CODE);
} else {
$("#paymentType").select2().select2('val', PAYMENT_CASH_CODE);
showBankDiv(PAYMENT_CASH_CODE);
}

voucher.hideDOM("#updateGridPaymentDetails",
"#updateGridVoucherDetails", "#deleteGridVoucherDetails",
"#deleteGridPaymentDetails", "#mobileDelete", "#independent");

voucher.selectMenuInitializeWithDefault({
'#organizationBranch': 'Select Organization Branch',
'#organization': 'Select Organization',
'#costCenterId': 'Select Cost Center',
'#chartOfAccounts': 'Select A/C SubCode',
'#bankAccount': 'Select Bank Account',
'#subLedger': 'Select A/C SubCode',
'#paymentSubType': 'Select Payment Sub Type'
});

voucher.initializeElementWithValue({'#totalDebit': '', '#total': 0});
}

function setOnChange() {

$('#paymentType').change(function () {
showBankDiv($('#paymentType').val());
});

$('#paymentSubType').change(function () {
subPayment($('#paymentSubType').val());
});

//Button event(Bank cheque details)
$("button#addToGridPaymentDetails").click(function () {
addDataToGridBank();
});
$("button#updateGridPaymentDetails").click(function () {
updateDataToGridBank();
});
$("button#deleteGridPaymentDetails").click(function () {
deleteDataFromGridBank();
});
$("button#resetDetails").click(function () {
initBankGridItems();
});

//Button event(mobile details)
$("button#addToMobileDetailsGrid").click(function () {
addDataToGridMobile();
});
$("button#mobileUpdate").click(function () {
updateDataToGridMobile();
});
$("button#mobileDelete").click(function () {
deleteDataToGridMobile();
});
$("button#resetMobileDetail").click(function () {
initMobileGridItems();
});

//Button event(voucher details)
$("button#addToGridVoucherDetails").click(function () {
addDataGridVoucherDetails();
});
$("button#updateGridVoucherDetails").click(function () {
updateDataGridVoucherDetails();
});
$("button#deleteGridVoucherDetails").click(function () {
deleteProjectWiseDetails();
});
$("button#resetVoucherDetails").click(function () {
initGridItems();
});

//Button event(voucher save)
$("button#save").click(function () {
saveVoucher('save');
});
$("button#saveUpdate").click(function () {
saveVoucher('update');
});
$("button#submit").click(function () {
saveAndSubmitVoucher();
});
$("button#delete").click(function () {
deleteVoucher();
});
$("button#resetDebitForm").click(function () {
resetForm();
});

$('#paymentDetailTable').dataTable().on('click', 'tr', function () {
var rowData = $('#paymentDetailTable').dataTable().fnGetData(this._DT_RowIndex);
initBankGridItems(rowData);
paymentRowId = $('#paymentDetailTable').dataTable().fnGetPosition($(this).closest('tr')[0]);
});

$('#mobilePaymentDetailsGrid').dataTable().on('click', 'tr', function () {
var rowData = $('#mobilePaymentDetailsGrid').dataTable().fnGetData(this._DT_RowIndex);
initMobileGridItems(rowData);
mrowId = $('#mobilePaymentDetailsGrid').dataTable().fnGetPosition($(this).closest('tr')[0]);
});

$("#issuDebitVoucherDetailTable").dataTable().on('click', 'tr', function () {
var rowData = $('#issuDebitVoucherDetailTable').dataTable().fnGetData(this._DT_RowIndex);
initGridItems(rowData);
voucherRowId = $('#issuDebitVoucherDetailTable').dataTable().fnGetPosition($(this).closest('tr')[0]);
});

}

function loadFileDocument(event) {

var output = document.getElementById('attachment');
output.src = URL.createObjectURL(event.target.files[0]);
if (checkFileSizeAndFormat(output, fileFormat)) {
} else {
$("input[type=file]").val("");
}

}

function showBankDiv(paymentType) {

$("#totalChequeAmount").val(0);

if (paymentType === PAYMENT_BANK_CODE) {

initBankGridItems();

} else if (paymentType === PAYMENT_CASH_CODE) {

voucher.hideDOM("#mobilePaymentDetailsDiv", "#bank_details");
voucher.showDOM("#cashSection", "#cashAmountWordSection");
voucher.initializeElementWithValue({'#cashAmount': ''});

} else if (paymentType === PAYMENT_MOBILE_CODE) {

voucher.getPaymentSubTypeList(PAYMENT_SUB_TYPE_LIST_URL, paymentType, '#paymentSubType', PAYMENT_BANK_CODE, '#mobilePaymentSubType');
;
initMobileGridItems();

} else {

voucher.hideDOM("#bank_details", "#cashSection", "#cashAmountWordSection", "#mobilePaymentDetailsDiv");
}
}

function subPayment(subPaymentId) {
var subPaymentName = $("#paymentSubType option:selected").text();

if (subPaymentName == 'BEFTN') {
$("#transactionNoDiv").hide();
} else {
$("#transactionNoDiv").show();
}

if (subPaymentId) {
if (subPaymentName == 'Online') {
    $('#transNo').html(subPaymentName + " Transaction No" + "<span class='mandatoryfield'>: *</span>");
    $('#transDate').html(subPaymentName + " Transaction Date" + "<span class='mandatoryfield'>: *</span>");
} else {
    $('#transNo').html(subPaymentName + " No" + "<span class='mandatoryfield'>: *</span>");
    $('#transDate').html(subPaymentName + " Date" + "<span class='mandatoryfield'>: *</span>");
}

} else {
$('#transNo').html("Transaction No" + "<span class='mandatoryfield'>: *</span>");
$('#transDate').html("Transaction Date" + "<span class='mandatoryfield'>: *</span>");

}

}

function initializeDetailsTables() {
voucherDetailColumns = [
{data: "project", title: "Project Id", "sClass": "hidden-col"},
{data: "p_name", title: "Project"},
{data: "coa_id", title: 'A/C Code', "sClass": "hidden-col"},
{data: "coa_name", title: 'A/C Code'},
{data: "sl_name", title: "A/C Sub-Code"},
{data: "debit", title: "Amount(Dr.)"},
{data: "remarks", title: "Particulars", "sClass": "hidden-col"},
{data: "amount_in_words", title: "amount", "sClass": "hidden-col"},
{data: "credit", title: "credit", "sClass": "hidden-col"},
{data: "sl_id", title: "slID", "sClass": "hidden-col"},
{data: "is_independent", title: 'is_independent', "sClass": "hidden-col"},
{data: "to_branch", title: 'to_branch', "sClass": "hidden-col"},
{data: "to_branch_name", title: 'To Branch'},
{data: "to_project_id", title: 'to_project', "sClass": "hidden-col"},
{data: "to_project_name", title: 'To Project'},
{data: "recon_code", title: 'Recon Code'},
{data: "recon_code_id", title: 'reconCodeId', "sClass": "hidden-col"},
{data: "entity", title: 'Entity'},
{data: "entity_id", title: 'entityId', "sClass": "hidden-col"},
{data: "areaCode", title: 'Area Code'}

];
doTable("#issuDebitVoucherDetailTable", voucherDetailColumns);

var objFooterColumns = {
columnText: 'p_name',
columnValue: 'debit'
};

$('#issuDebitVoucherDetailTable').dataTable().fnSettings().aoFooterCallback.push({
"fn": function (row, data, start, end, display) {

    $('#issuDebitVoucherDetailTable tfoot').remove();
    var amount = 0;
    $.each($('#issuDebitVoucherDetailTable').dataTable().fnGetData(), function (i, val) {
        amount += toLocaleStringUnset(eval("data[i]." + objFooterColumns.columnValue));
    });
    var footer = $("<tfoot></tfoot>").appendTo("#issuDebitVoucherDetailTable");
    var footertr = $("<tr></tr>").appendTo(footer);
    for (var i = 0; i < voucherDetailColumns.length; i++) {
        if (voucherDetailColumns[i].sClass === 'hidden-col') {
            continue;
        }
        if (voucherDetailColumns[i].data === objFooterColumns.columnText) {
            $("<th class='datatable-heading'><b>Total</b></th>").appendTo(footertr);
        } else if (voucherDetailColumns[i].data === objFooterColumns.columnValue) {
            $("<th class='datatable-heading'><b>" + toLocaleStringSet(amount) + "</b></th>").appendTo(footertr);
        } else {
            $("<th class='datatable-heading'></th>").appendTo(footertr);
        }
    }

    var amountInWord = "Total Amount: " + amountToTextWithDecimal(amount);
    $("#total").val(amount);
    footertr = $("<tr><th colspan='" + (voucherDetailColumns.length + 1) + "'>" + amountInWord + "</th></tr>").appendTo(footer);
}
});
}

function updateDataGridVoucherDetails() {
var rv = false;
if (voucherRowId >= 0) {
var checkVal = checkValidationVoucherDetails();
if (checkVal && checkVal.success === true) {
    doTable('#issuDebitVoucherDetailTable', voucherDetailColumns, checkVal.data, 'update', voucherRowId);
    initGridItems();
}
}
return rv;
}

function deleteProjectWiseDetails() {
swal({
    title: "Are you sure?",
    text: "The details will be removed!",
    type: "warning",
    showCancelButton: true,
    confirmButtonColor: "#c49f47",
    confirmButtonText: "Yes",
    closeOnConfirm: true
},
function (isConfirm) {
    if (isConfirm) {
        var rowData = $('#issuDebitVoucherDetailTable').dataTable().fnGetData(voucherRowId);
        var amount = Number(rowData.debit);
        $('#issuDebitVoucherDetailTable').dataTable().fnDeleteRow(voucherRowId);
        initGridItems();
    }
});

}

function deleteDataFromGridBank() {
swal({
    title: "Are you sure?",
    text: "The details will be removed!",
    type: "warning",
    showCancelButton: true,
    confirmButtonColor: "#c49f47",
    confirmButtonText: "Yes",
    closeOnConfirm: true
},
function (isConfirm) {
    if (isConfirm) {
        var rowData = $('#paymentDetailTable').dataTable().fnGetData(paymentRowId);
        var amount = Number(rowData.checkamount);
        $('#paymentDetailTable').dataTable().fnDeleteRow(paymentRowId);
        initGridItems();
    }
});
}

function updateDataToGridBank() {
var rv = false;
if (paymentRowId >= 0) {
var checkVal = chequeValidation();
if (checkVal && checkVal.success === true) {
    doTable('#paymentDetailTable', chequeDetailsColumns, checkVal.data, 'update', paymentRowId);
    initBankGridItems();
}
}
return rv;
}

function addDataToGridBank() {
var rv = false;
var checkVal = chequeValidation();
if (checkVal && checkVal.success === true) {
doTable('#paymentDetailTable', chequeDetailsColumns, checkVal.data, 'add');
initBankGridItems();
}
return rv;
}

function chequeValidation() {
var result = {};
var msg = "";
var obj = {};
var paymentSubType = $("#paymentSubType option:selected").text();
if (!$("#bankAccount").val()) {
msg += "Please select bank account <br />";
} else if ($("#bankAccount").val()) {
obj['bankaccountid'] = $("#bankAccount").val();
obj['bankaccount'] = $("#bankAccount option:selected").text();
}

if (!$("#paymentSubType").val()) {
msg += "Please select payment sub type <br />";
} else if ($("#paymentSubType").val()) {
obj['paymentsubtypeid'] = $("#paymentSubType").val();
obj['paymentsubtype'] = $("#paymentSubType option:selected").text();
}

if (!$("#checkAmount").val()) {
msg += "Please insert amount <br />";
} else if(numberWithDecimal($("#checkAmount").val()) == 0){
msg += "Please insert amount greater than 0 <br />";
}else if ($("#checkAmount").val()) {
obj['checkamount'] = numberWithDecimal($("#checkAmount").val());
}

if (!$("#checkNo").val()) {
msg += "Please input " + paymentSubType + " No <br />";
} else if ($("#checkNo").val()) {
obj['checkno'] = $("#checkNo").val();
}

if (!$("#checkDate").val()) {
msg += "Please select " + paymentSubType + " date <br />";
} else if ($("#checkDate").val()) {
obj['checkdate'] = $("#checkDate").val();
}

if (msg !== "") {
showError(msg);
result['success'] = false;
} else {
obj['remarks'] = $("#remarks").val();
result['success'] = true;
result['data'] = [obj];
}

return result;
}

function addDataToGridMobile() {
var rv = false;
var checkVal = checkValidationMobilePaymentDetails();
if (checkVal && checkVal.success === true) {
doTable('#mobilePaymentDetailsGrid', mobilePaymentDetailsColumns, checkVal.data, 'add');
initMobileGridItems();
}
return rv;
}

function updateDataToGridMobile() {
var rv = false;
if (mrowId >= 0) {
var checkVal = checkValidationMobilePaymentDetails();
if (checkVal && checkVal.success === true) {
    doTable('#mobilePaymentDetailsGrid', mobilePaymentDetailsColumns, checkVal.data, 'update', mrowId);
    initMobileGridItems();
}
}
return rv;
}

function deleteDataToGridMobile() {
swal({
    title: "Delete details?",
    text: "Are you sure to delete the details?",
    type: "warning",
    showCancelButton: true,
    confirmButtonColor: "#c49f47",
    confirmButtonText: "Yes",
    closeOnConfirm: true
},
function (isConfirm) {
    if (isConfirm) {
        $('#mobilePaymentDetailsGrid').dataTable().fnDeleteRow(mrowId);
        initMobileGridItems();
    }
});
}

function addDataGridVoucherDetails() {
var rv = false;
var checkVal = checkValidationVoucherDetails();
if (checkVal && checkVal.success === true) {
doTable('#issuDebitVoucherDetailTable', voucherDetailColumns, checkVal.data, 'add');
initGridItems();
}
}

function checkSummation() {
var dr = 0;
var chequeamount = 0;
var cr = 0;
var debitamount = 0;

if ($("#paymentType").val() === PAYMENT_BANK_CODE) {
dr = $("#totalChequeAmount").val();
chequeamount = parseFloat(dr.replace(/,/g, ''));
if (chequeamount === 0) {
    showError('Empty payment details not allowed');
    return false;
}

cr = $("#total").val();
debitamount = parseFloat(cr.replace(/,/g, ''));

if (chequeamount === debitamount) {
    return true
} else {
    showError('Total debit amount must be equal to cheque/cash amount ');
}
} else if ($("#paymentType").val() === PAYMENT_MOBILE_CODE) {
dr = $("#totalChequeAmount").val();
chequeamount = parseFloat(dr.replace(/,/g, ''));
if (chequeamount === 0) {
    showError('Empty payment details not allowed');
    return false;
}

cr = $("#total").val();
debitamount = parseFloat(cr.replace(/,/g, ''));

if (chequeamount === debitamount) {
    return true
} else {
    showError('Total debit amount must be equal to cheque/cash amount ');
}
} else if ($("#paymentType").val() === PAYMENT_CASH_CODE) {

chequeamount = Number($("#cashAmount").val());
cr = $("#total").val();
debitamount = parseFloat(cr.replace(/,/g, ''));

if (chequeamount === debitamount) {
    return true
} else {
    showError('Total debit amount must be equal to cheque/cash amount ');
}
} else
return true
}


function checkValidationVoucherDetails() {
var result = {};
var msg = "";
var obj = {};

if ($("#paytoType").val() === '') {
showError('Please select pay to type');
return;
}

if ($("#paytoType").val() != '') {
if (($("#paytoType").val() == "customer") || ($("#paytoType").val() == "supplier")) {
    if ($("#paytoName").val() === '') {
        showError('Please select pay to name');
        return;
    }
}
if ($("#paytoType").val() == "other") {
    if ($("#paytoNameTxt").val() === '') {
        showError('Please input pay to name');
        return;
    }
}
}

if (!$("#projectName").val()) {
msg += "Please select Project <br />";
} else if ($("#projectName").val()) {
obj['project'] = $("#projectName").val();
obj['p_name'] = $("#projectName option:selected").text();
}

if (!$("#chartOfAccounts").val()) {
msg += "Please select A/C Code <br />";
} else if ($("#chartOfAccounts").val()) {
if((cahoId == $("#chartOfAccounts").val()) && ($("#toBranch").val() == $("#branchId").val())){
    msg += "Please select different branch <br />";
}else{
    obj['coa_id'] = $("#chartOfAccounts").val();
    obj['coa_name'] = $("#chartOfAccounts option:selected").text();
}
}

if ($('#subLedgerWrap').is(':visible') && !$("#subLedger").val()) {
msg += "Please select A/C Sub-Code <br />";
} else if ($('#subLedgerWrap').is(':visible') && $("#subLedger").val()) {
obj['sl_id'] = $("#subLedger").val();
obj['sl_name'] = $("#subLedger option:selected").text();
}

if ($('#toBranchWrap').is(':visible') && !$("#toBranch").val()) {
msg += "Please select To Branch <br />";
} else if ($('#toBranchWrap').is(':visible') && $("#toBranch").val()) {
obj['to_branch'] = $("#toBranch").val();
obj['to_branch_name'] = $("#toBranch").select2('data').name;
}

if ($('#toProjectWrap').is(':visible') && !$("#toProject").select2('data').id) {
msg += "Please select To Project <br />";
} else if ($('#toProjectWrap').is(':visible') && $("#toProject").val()) {
obj['to_project_id'] = $("#toProject").val();
obj['to_project_name'] = $("#toProject option:selected").text();
}

if ($('#reconCodeWrap').is(':visible') && !$("#reconCode").val()) {
msg += "Please select ReconCode <br />";
} else if ($('#reconCodeWrap').is(':visible') && $("#reconCode").val()) {
obj['recon_code_id'] = $("#reconCode").val();
obj['recon_code'] = $("#reconCode option:selected").text();
}

if ($('#entityDiv').is(':visible') && !$("#entityId").val()) {
//msg += "Please select Entity <br />";
} else if ($('#entityDiv').is(':visible') && $("#entityId").val()) {
obj['entity_id'] = $("#entityId").val();
obj['entity'] = $("#entityId option:selected").text();
}

if (!$("#debit").val()) {
msg += "Please input Amount <br />";
} else if (numberWithDecimal($("#debit").val()) === 0) {
msg += "Please input Amount greater than 0 <br />";
} else {
obj['debit'] = numberWithDecimal($("#debit").val());
}

if (!$.trim($("#remarksp").val())) {
msg += "Please input particulars <br />";
}


if ($('#warp_areaCode').is(':visible') && !$("#areaCode").val()) {
msg += "Please input area code <br />";
} else if ($('#warp_areaCode').is(':visible') && $("#areaCode").val()) {
if (!$('#areaCode').is('[readonly]')) {
    var value = document.getElementById('areaCode').value;
    /*if (value.length < 8) {
        msg += 'Area Code must be 8 digit <br />';
    } else {
        obj['areaCode'] = $("#areaCode").val();
    }*/

    obj['areaCode'] = $("#areaCode").val();

    var ajaxResponse = voucher.getAjaxResponse('accReconCode/accHoGlCodes',
        {
            project_id : $('#toProject').val(),
            branch_id  : $('#toBranch').val(),
            area_code  : $("#areaCode").val()

        },false);

    if(ajaxResponse.isError){
        msg = (msg) ? msg + ajaxResponse.message+"<br />" : ajaxResponse.message+"<br />";
    }



} else {
    obj['areaCode'] = $("#areaCode").val();
}
}

obj['amount_in_words'] = $("#amount").val();

if (msg !== "") {
showError(msg);
result['success'] = false;
} else {
obj['remarks'] = $("#remarksp").val();
result['success'] = true;
result['data'] = [obj];
}

return result;
}

function checkValidationSave() {
if ($("#dateOfCreation").val() === '') {
showError('Date not found!');
return;
}
if ($("#programType").val() === '') {
showError('Please select program type');
return;
}

if (!$.trim($("#description").val())) {
showError('Please input description');
return;
}

if ($("#paytoType").val() === '') {
showError('Please select pay to type');
return;
}

if ($("#paytoType").val() != '') {
if (($("#paytoType").val() == "customer") || ($("#paytoType").val() == "supplier")) {
    if ($("#paytoName").val() === '') {
        showError('Please select pay to name');
        return;
    }
}
if ($("#paytoType").val() == "other") {
    if ($("#paytoNameTxt").val() === '') {
        showError('Please input pay to name');
        return;
    }
}
}
if ($("#paymentType").val() === '' || $("#paymentType").val() === '') {
showError('Please select payment type');
return;
}

return true;
}

function saveVoucher(status) {
$("#isDebitNote").prop("checked", true);

var paymentMode = $("#paymentType").val();

if (!checkValidationSave()) {
return false;
}

if (!checkSummation()) {
return false;
}

var tableData = $('#issuDebitVoucherDetailTable').dataTable().fnGetData();
var dataLength = tableData.length;
if (dataLength === 0) {
showError('Debit voucher can not be submitted without voucher details');
return false;
}

var data = new FormData(document.forms.namedItem("issueDebitVoucherForm"));
data.append('voucherType', 'DV');
data.append('branchId', $("#branchId").val());

if (paymentMode === PAYMENT_BANK_CODE) {
var tableDataPayment = $('#paymentDetailTable').dataTable().fnGetData();
var dataLengthPayment = tableDataPayment.length;
for (var k = 0; k < dataLengthPayment; k++) {
    data.append('payments.paymentDetails[' + k + '].bankaccountid', tableDataPayment[k].bankaccountid);
    data.append('payments.paymentDetails[' + k + '].checkamount', tableDataPayment[k].checkamount);
    data.append('payments.paymentDetails[' + k + '].checkno', tableDataPayment[k].checkno);
    data.append('payments.paymentDetails[' + k + '].checkdate', tableDataPayment[k].checkdate);
    data.append('payments.paymentDetails[' + k + '].remarks', tableDataPayment[k].remarks);
    data.append('payments.paymentDetails[' + k + '].paymentsubtypeid', tableDataPayment[k].paymentsubtypeid);
    data.append('payments.paymentDetails[' + k + '].paymentsubtype', tableDataPayment[k].paymentsubtype);
}
}
if (paymentMode === PAYMENT_MOBILE_CODE) {
var tableDataMobilePaymentVoucher = $('#mobilePaymentDetailsGrid').dataTable().fnGetData();
var dataLengthMobilePayableVoucher = tableDataMobilePaymentVoucher.length;
for (var j = 0; j < dataLengthMobilePayableVoucher; j++) {
    data.append('payments.paymentVoucher[' + j + '].paymentSubType', tableDataMobilePaymentVoucher[j].acc_payment_sub_type_id);
    data.append('payments.paymentVoucher[' + j + '].mobileNumber', tableDataMobilePaymentVoucher[j].mobile_number);
    data.append('payments.paymentVoucher[' + j + '].mobileAmount', tableDataMobilePaymentVoucher[j].mobile_amount);
    data.append('payments.paymentVoucher[' + j + '].mobileTransactionNo', tableDataMobilePaymentVoucher[j].mobile_transaction_no);
    data.append('payments.paymentVoucher[' + j + '].mobileTransactionDate', tableDataMobilePaymentVoucher[j].mobile_transaction_date);
    data.append('payments.paymentVoucher[' + j + '].remarks', tableDataMobilePaymentVoucher[j].mobile_remarks);
}
}

var dataLengthVD = tableData.length;
for (var i = 0; i < dataLengthVD; i++) {
data.append('items.voucherDetails[' + i + '].debit', numberWithDecimal(tableData[i].debit));
data.append('items.voucherDetails[' + i + '].credit', numberWithDecimal(tableData[i].credit));
data.append('items.voucherDetails[' + i + '].projectId', tableData[i].project); // project
data.append('items.voucherDetails[' + i + '].chartOfAccountsId', tableData[i].coa_id); //coa_id
data.append('items.voucherDetails[' + i + '].subsidiaryLedger', tableData[i].sl_id); //sl_id
data.append('items.voucherDetails[' + i + '].remarks', tableData[i].remarks);
data.append('items.voucherDetails[' + i + '].toProjectId', tableData[i].to_project_id ? tableData[i].to_project_id : '');//to_project_id
data.append('items.voucherDetails[' + i + '].reconCode', tableData[i].recon_code_id ? tableData[i].recon_code_id : '');
data.append('items.voucherDetails[' + i + '].controlBranchId', tableData[i].to_branch ? tableData[i].to_branch : '');//controlBranch
data.append('items.voucherDetails[' + i + '].accountName', tableData[i].coa_name);
data.append('items.voucherDetails[' + i + '].details', tableData[i].details? tableData[i].details: '');
data.append('items.voucherDetails[' + i + '].amount', tableData[i].amount_in_words);
data.append('items.voucherDetails[' + i + '].sl_name', tableData[i].sl_name);
data.append('items.voucherDetails[' + i + '].entityId', tableData[i].entity_id ? tableData[i].entity_id : '');
data.append('items.voucherDetails[' + i + '].areaCode', tableData[i].areaCode ? tableData[i].areaCode : '');
}

var params = {
url : ISSUE_DEBIT_VOUCHER_SAVE_URL,
successCallBack : 'saveVoucherSuccess',
status : status,
formData : data,
htmlIdToDisable: '#saveOptions button'
};
voucher.ajaxSubmit(params);
}

function saveVoucherSuccess(response, params) {

if (params.status === 'save') {
resetForm();
} else {
var url = "accJournalMaster/debitList";
document.location.hash = url;
loadUrl(url);
}
}

function saveAndSubmitVoucher() {
$("#isDebitNote").prop("checked", true);
if (!checkValidationSave()) {
return false;
}

var tableData = $('#issuDebitVoucherDetailTable').dataTable().fnGetData();
var dataLength = tableData.length;
if (dataLength === 0) {
showError('Debit voucher can not be submitted without voucher details');
return false;
}

var totalAmount, totalDebitAmount;
var dr = cr = 0;
if ($("#paymentType").val() === PAYMENT_BANK_CODE) {
dr = $("#totalChequeAmount").val();
totalAmount = parseFloat(dr.replace(/,/g, ''));

cr = $("#total").val();
totalDebitAmount = parseFloat(cr.replace(/,/g, ''));
} else if ($("#paymentType").val() === PAYMENT_MOBILE_CODE) {
dr = $("#totalChequeAmount").val();
totalAmount = parseFloat(dr.replace(/,/g, ''));

cr = $("#total").val();
totalDebitAmount = parseFloat(cr.replace(/,/g, ''));

} else if ($("#paymentType").val() === PAYMENT_CASH_CODE) {
totalAmount = Number($("#cashAmount").val());
var cr = $("#total").val();
totalDebitAmount = parseFloat(cr.replace(/,/g, ''));
}

if (totalAmount !== totalDebitAmount) {
showError('Total debit amount must be equal to payment amount ');
return;
}

var attach = $('#attachment').val();
var attachWarning = '';
if (attach === '') {
attachWarning = 'Submit voucher without attachment?'
} else {
attachWarning = 'Submit voucher?'
}
swal({
    title: attachWarning,
    text: "You can not edit after you submit voucher! Are you sure?",
    type: "warning",
    showCancelButton: true,
    confirmButtonColor: "#c49f47",
    confirmButtonText: "Yes",
    closeOnConfirm: true
},
function (isConfirm) {
    if (isConfirm) {
        var paymentMode = $("#paymentType").val();
        var data = new FormData(document.forms.namedItem("issueDebitVoucherForm"));
        data.append('voucherType', 'DV');
        data.append('totalAmount', totalAmount);
        data.append('totalDebitAmount', totalDebitAmount);
        data.append('branchId', $("#branchId").val());

        if (paymentMode === PAYMENT_BANK_CODE) {
            var tableDataPayment = $('#paymentDetailTable').dataTable().fnGetData();
            var dataLengthPayment = tableDataPayment.length;
            for (var k = 0; k < dataLengthPayment; k++) {
                data.append('payments.paymentDetails[' + k + '].bankaccountid', tableDataPayment[k].bankaccountid);
                data.append('payments.paymentDetails[' + k + '].checkamount', tableDataPayment[k].checkamount);
                data.append('payments.paymentDetails[' + k + '].checkno', tableDataPayment[k].checkno);
                data.append('payments.paymentDetails[' + k + '].checkdate', tableDataPayment[k].checkdate);
                data.append('payments.paymentDetails[' + k + '].remarks', tableDataPayment[k].remarks);
                data.append('payments.paymentDetails[' + k + '].paymentsubtypeid', tableDataPayment[k].paymentsubtypeid);
                data.append('payments.paymentDetails[' + k + '].paymentsubtype', tableDataPayment[k].paymentsubtype);
            }
        }
        if (paymentMode === PAYMENT_MOBILE_CODE) {
            var tableDataMobilePaymentVoucher = $('#mobilePaymentDetailsGrid').dataTable().fnGetData();
            var dataLengthMobilePayableVoucher = tableDataMobilePaymentVoucher.length;
            for (var j = 0; j < dataLengthMobilePayableVoucher; j++) {
                data.append('payments.paymentVoucher[' + j + '].paymentSubType', tableDataMobilePaymentVoucher[j].acc_payment_sub_type_id);
                data.append('payments.paymentVoucher[' + j + '].mobileNumber', tableDataMobilePaymentVoucher[j].mobile_number);
                data.append('payments.paymentVoucher[' + j + '].mobileAmount', tableDataMobilePaymentVoucher[j].mobile_amount);
                data.append('payments.paymentVoucher[' + j + '].mobileTransactionNo', tableDataMobilePaymentVoucher[j].mobile_transaction_no);
                data.append('payments.paymentVoucher[' + j + '].mobileTransactionDate', tableDataMobilePaymentVoucher[j].mobile_transaction_date);
                data.append('payments.paymentVoucher[' + j + '].remarks', tableDataMobilePaymentVoucher[j].mobile_remarks);
            }
        }

        var dataLengthVD = tableData.length;
        for (var i = 0; i < dataLengthVD; i++) {

            data.append('items.voucherDetails[' + i + '].debit', numberWithDecimal(tableData[i].debit));
            data.append('items.voucherDetails[' + i + '].credit', numberWithDecimal(tableData[i].credit));
            data.append('items.voucherDetails[' + i + '].projectId', tableData[i].project); // project
            data.append('items.voucherDetails[' + i + '].chartOfAccountsId', tableData[i].coa_id); //coa_id
            data.append('items.voucherDetails[' + i + '].subsidiaryLedger', tableData[i].sl_id); //sl_id
            data.append('items.voucherDetails[' + i + '].remarks', tableData[i].remarks);
            data.append('items.voucherDetails[' + i + '].accCostCenter', 1); //costCenterId
            data.append('items.voucherDetails[' + i + '].toProjectId', tableData[i].to_project_id ? tableData[i].to_project_id : '');//to_project_id
            data.append('items.voucherDetails[' + i + '].reconCode', tableData[i].recon_code_id ? tableData[i].recon_code_id : '');
            data.append('items.voucherDetails[' + i + '].controlBranchId', tableData[i].to_branch ? tableData[i].to_branch : '');//controlBranch

            data.append('items.voucherDetails[' + i + '].accountName', tableData[i].coa_name);
            data.append('items.voucherDetails[' + i + '].details', tableData[i].details?tableData[i].details:'');
            data.append('items.voucherDetails[' + i + '].amount', tableData[i].amount_in_words?tableData[i].amount_in_words:'');
            data.append('items.voucherDetails[' + i + '].sl_name', tableData[i].sl_name);
            data.append('items.voucherDetails[' + i + '].entityId', tableData[i].entity_id ? tableData[i].entity_id : '');
            data.append('items.voucherDetails[' + i + '].areaCode', tableData[i].areaCode ? tableData[i].areaCode : '');
        }

        var params = {
            url : '/node/accJournalMaster/saveAndSubmitDebitVoucher',
            successCallBack : 'saveAndSubmitVoucherSuccess',
            isEditMode : isEditMode,
            formData : data,
            htmlIdToDisable: '#saveOptions button'
        };
        voucher.ajaxSubmit(params);

    }
});
}

function saveAndSubmitVoucherSuccess(response, params) {

if (params.isEditMode) {
var url = "accJournalMaster/debitList";
document.location.hash = url;
loadUrl(url);
} else {
resetForm();
}
}

function deleteVoucher() {
swal({
    title: "Are You Sure?",
    text: "The details will be removed!",
    type: "warning",
    showCancelButton: true,
    confirmButtonColor: "#c49f47",
    confirmButtonText: "Yes",
    closeOnConfirm: true
},
function (isConfirm) {
    if (isConfirm) {

        var params = {
            url : DELETE_DEBIT_VOUCHER_URL,
            successCallBack : 'deleteVoucherSuccess',
            formData : {voucher_no : $("#voucher_no").val()},
            htmlIdToDisable: '#saveOptions button',
            addProcessDataProperty : 'No'
        };
        voucher.ajaxSubmit(params);
    }
});
}

function deleteVoucherSuccess(response, params) {
var url = "accJournalMaster/debitList";
document.location.hash = url;
loadUrl(url);
}

function resetForm() {
loadUrl('accJournalMaster/showIssueDebitVoucher');
}

function changeNumberToText(value) {
var amountToConvert = amountToTextWithDecimal(value);
$("#amount").val(amountToConvert);
}

function changeCashAmountToText(value) {
var amountToConvert = amountToTextWithDecimal(value);
$("#cashAmountWord").val(amountToConvert);
}

function addParticular(value) {
if($('#chartOfAccounts').val() != cahoId) {
voucher.initializeElementWithValue({'#remarksp': 'Paid To ' + value + ' against'})
}
}

function doTable(id, columns, data, action, rowIndexId) {

if (!$.fn.DataTable.isDataTable(id)) {

$(id).dataTable({
    "bPaginate": false,
    "bInfo": false,
    "searching": false,
    "columns": columns,
    "order": [
        [0, "asc"]
    ]
});
}

if (data && data.length > 0) {
var table = $(id).dataTable();
$.each(data, function (i, val) {
    $.each(columns, function (index, value) {
        val[value.data] = (val[value.data]) ? val[value.data] : "";
    });
});
if (action === 'add') {
    table.fnAddData(data);
} else if (action === 'update') {

    var rowIndex = rowIndexId;
    var columnIndex = 0;
    $.each(data, function (i, val) {
        $.each(columns, function (index, value) {
            table.fnUpdate(val[value.data], rowIndex, columnIndex, true);
            columnIndex++;
        });
    });

}
}

}

function initPopulateMobileDetailsGrid() {
chequeDetailsColumns = [
{data: "paymentsubtypeid", title: "Payment Id", sClass: "hidden-col"},
{data: "paymentsubtype", title: "Payment Sub Type"},
{data: 'bankaccount', title: "Bank Account"},
{data: "checkno", title: "Transaction No"},
{data: "checkdate", title: "Transaction Date"},
{data: "checkamount", title: "Amount"},
{data: "remarks", title: "Particulars"},
{data: 'bankaccountid', title: "bank Account Id", sClass: "hidden-col"}
];
doTable("#paymentDetailTable", chequeDetailsColumns);

var chequeFooterColumns = {
columnText: 'paymentsubtype',
columnValue: 'checkamount'
};

$('#paymentDetailTable').dataTable().fnSettings().aoFooterCallback.push({
"fn": function (row, data, start, end, display) {

    $('#paymentDetailTable tfoot').remove();
    var amount = 0;
    $.each($('#paymentDetailTable').dataTable().fnGetData(), function (i, val) {
        amount += toLocaleStringUnset(eval("data[i]." + chequeFooterColumns.columnValue));
    });
    var footer = $("<tfoot></tfoot>").appendTo("#paymentDetailTable");
    var footertr = $("<tr></tr>").appendTo(footer);
    for (var i = 0; i < chequeDetailsColumns.length; i++) {
        if (chequeDetailsColumns[i].sClass === 'hidden-col') {
            continue;
        }
        if (chequeDetailsColumns[i].data === chequeFooterColumns.columnText) {
            $("<th class='datatable-heading'><b>Total</b></th>").appendTo(footertr);
        } else if (chequeDetailsColumns[i].data === chequeFooterColumns.columnValue) {
            $("<th class='datatable-heading'><b>" + toLocaleStringSet(amount) + "</b></th>").appendTo(footertr);
        } else {
            $("<th class='datatable-heading'></th>").appendTo(footertr);
        }
    }
    var amountInWord = "Total Amount: " + amountToTextWithDecimal(amount);
    $("#totalChequeAmount").val(amount);
    footertr = $("<tr><th colspan='" + (chequeDetailsColumns.length + 1) + "'>" + amountInWord + "</th></tr>").appendTo(footer);
}
});

mobilePaymentDetailsColumns = [
{data: "id", title: "ID", sClass: "hidden-col"},
{data: "acc_payment_sub_type_id", title: "Payment Sub Type Id", sClass: "hidden-col"},
{data: "paymentsubtype", title: "Payment Sub Type"},
{data: "mobile_number", title: "Mobile Number"},
{data: "mobile_amount", title: "Amount"},
{data: "mobile_transaction_no", title: "Transaction No"},
{data: "mobile_transaction_date", title: "Transaction Date"},
{data: "mobile_remarks", title: "Remarks", sClass: "hidden-col"}
];
doTable("#mobilePaymentDetailsGrid", mobilePaymentDetailsColumns);

var mobileFooterColumns = {
columnText: 'acc_payment_sub_type_id',
columnValue: 'mobile_amount'
};

$('#mobilePaymentDetailsGrid').dataTable().fnSettings().aoFooterCallback.push({
"fn": function (row, data, start, end, display) {

    $('#mobilePaymentDetailsGrid tfoot').remove();
    var amount = 0;
    $.each($('#mobilePaymentDetailsGrid').dataTable().fnGetData(), function (i, val) {
        amount += toLocaleStringUnset(eval("data[i]." + mobileFooterColumns.columnValue));
    });
    var footer = $("<tfoot></tfoot>").appendTo("#mobilePaymentDetailsGrid");
    var footertr = $("<tr></tr>").appendTo(footer);
    for (var i = 0; i < mobilePaymentDetailsColumns.length; i++) {
        if (mobilePaymentDetailsColumns[i].sClass === 'hidden-col') {
            continue;
        }
        if (mobilePaymentDetailsColumns[i].data === mobileFooterColumns.columnText) {
            $("<th class='datatable-heading'><b>Total</b></th>").appendTo(footertr);
        } else if (mobilePaymentDetailsColumns[i].data === mobileFooterColumns.columnValue) {
            $("<th class='datatable-heading'><b>" + toLocaleStringSet(amount) + "</b></th>").appendTo(footertr);
        } else {
            $("<th class='datatable-heading'></th>").appendTo(footertr);
        }
    }

    var amountInWord = "Total Amount: " + amountToTextWithDecimal(amount);
    $("#totalChequeAmount").val(amount);
    footertr = $("<tr><th colspan='" + (mobilePaymentDetailsColumns.length + 1) + "'>" + amountInWord + "</th></tr>").appendTo(footer);
}
});
}

function checkValidationMobilePaymentDetails() {
var result = {};
var msg = "";
var obj = {};

if ($('#mobilePaymentSubTypewrap').is(':visible') && !$("#mobilePaymentSubType").val()) {
msg += "Please select payment sub type <br />";
} else if ($("#mobilePaymentSubType").val()) {
obj['acc_payment_sub_type_id'] = $("#mobilePaymentSubType").val();
obj['paymentsubtype'] = $("#mobilePaymentSubType option:selected").text();
}

if ($('#mobileNumberwap').is(':visible') && !$("#mobileNumber").val()) {
msg += "Please select mobile number <br />";
} else if ($("#mobileNumber").val()) {
obj['mobile_number'] = $("#mobileNumber").val();
}

if ($('#mobileAmountWrap').is(':visible') && !$("#mobileAmount").val()) {
msg += "Please input payment amount <br />";
} else if ($("#mobileAmount").val()) {
obj['mobile_amount'] = numberWithDecimal($("#mobileAmount").val());
}

if ($('#mobileTransactionNoWrap').is(':visible') && !$("#mobileTransactionNo").val()) {
msg += "Please select transaction no <br />";
} else if ($("#mobileTransactionNo").val()) {
obj['mobile_transaction_no'] = $("#mobileTransactionNo").val();
}

if ($('#mobileTransactionDateWrap').is(':visible') && !$("#mobileTransactionDate").val()) {
msg += "Please select transaction date <br />";
} else if ($("#mobileTransactionDate").val()) {
obj['mobile_transaction_date'] = $("#mobileTransactionDate").val();
}

if (msg !== "") {
showError(msg);
result['success'] = false;
} else {
obj['mobile_remarks'] = $("#mobileRemarks").val();
result['success'] = true;
result['data'] = [obj];
}

return result;
}

$('#toProject').change(function (event, params) {
if($('#chartOfAccounts').val() == cahoId){
makeCahoParticular($("#toBranch").select2('data').name,$("#toProject option:selected").text());
}
if (params) {

} else {
onToProjectChange();
}
});

function onToProjectChange() {
var toProject = $("#toProject").val();
var toBranch = $("#toBranch").val();
var areaCode = $("#areaCode").val();
var reconCode = $("#reconCode").val();
if (!$('#toBranch').is('[readonly]') || !overHeadFlag) {
if (toProject && toBranch) {
    var params = "officeId=" + toBranch + "&projectId=" + toProject;
    $.ajax({
        url: '/node/accJournalMaster/getAreaCodeByOfficeAndProject',
        type: 'GET',
        data: params,
        dataType: 'json',
        success: function (data) {
            var officeId = $("#toBranch").val();
            $("#areaCode").val(data.areaCode);
            if (officeId !== '2') {
                $("#areaCode").prop("readonly", true);
                if (data.areaCode) {
                    areaCodeByProject = true;
                }
            } else {
                $("#areaCode").prop("readonly", false);
            }
        }, error: function (x, e) {
            onAjaxError(x, e);
        }
    });
}
}

}

function reconCodeDropDownOnChanges(event, params) {
var id = "#reconCode";
var fieldToBranchId = "#toBranch";
var fieldToProjectId = "#toProject";
var flagProgoti = ($("#projectName").val().toString() !== currentBranchOverHeadProject.id.toString()) ? true : false;

if (flagProgoti === false && $(id).val() && !params) {

$.each(accReconCodeListWithCriteria, function (i, val) {
    if (val.id.toString() === $(id).val().toString()) {

        var fixedAreaCode = (val.fixedAreaCode && val.fixedAreaCode === 'NULL') ? null : val.fixedAreaCode;
        if (fixedAreaCode) {
            $(fieldToBranchId).val("2").trigger("change");
            $("#areaCode").val(fixedAreaCode);
            $("#areaCode").prop("readonly", true);
            areaCodeByProject = false;
            if (!toProjectFlag) {
                toBranchChange();
            } else {
                toProjectFlag = false;
            }
            $(fieldToBranchId).attr("readonly", true);
        } else {
            if (!areaCodeByProject) {
                $("#areaCode").val('');
                $("#areaCode").prop("readonly", false);
                areaCodeByProject = true;
            }
            $(fieldToBranchId).attr("readonly", false);
            $(fieldToProjectId).attr("readonly", false);
        }

        var fixedProjectCode = (val.fixedProjectId && val.fixedProjectId === 'NULL') ? null : val.fixedProjectId;
        if (fixedProjectCode) {
            voucher.projectDropDown('#toProject', fixedProjectCode, null, 'projects', '2', 'Select To Project', null, false);
            $(fieldToProjectId).attr("readonly", true);
        } else {
            $(fieldToProjectId).attr("readonly", false);
        }
    }
});

} else if (flagProgoti === false && !$(id).val()) {
$("#areaCode").val('');
$("#areaCode").prop("readonly", true);
$(fieldToProjectId).attr("readonly", false);
$(fieldToBranchId).attr("readonly", false);
} else {
$(fieldToProjectId).attr("readonly", true);
$(fieldToBranchId).attr("readonly", true);
}
}

function reconCodeDropDownSuccess(id, defaultSelectId, skipValues, placeholder, async, params, result) {
//accReconCodeListWithCriteria = result.reconList;
if(params.recon_code_type === 'TRANSFER'){
accReconCodeListWithCriteriaTransfer = result.reconList;
}
else if(params.recon_code_type === 'RECEIVE'){
accReconCodeListWithCriteriaReceive = result.reconList;
}
//voucher.reconCodeDropDownWithCriteria(id, defaultSelectId, placeholder, null, true, null);
}

function initGridItems(row) {
if(row){
if (!row.project) {
    return
}
}
$("#debit, #amount, #toBranch, #accountName, #areaCode, #entityId").val('');
voucher.hideDOM(
"#subLedgerWrap", "#toBranchWrap", "#toProjectWrap", "#reconCodeWrap", "#warp_areaCode", "#entityDiv",
"#updateGridVoucherDetails", "#deleteGridVoucherDetails"
);
voucherRowId = null;
areaCodeByProject = false;
if (!row) {
voucher.showDOM("#addToGridVoucherDetails");
voucher.projectDropDown('#projectName', null, $('#programType').val(), 'projects', $('#branchId').val(), 'Select Project', employeeId, false);
$("#projectName").select2("val", "");
voucher.resetDropDown('#chartOfAccounts', 'Select A/C Code');
voucher.hideDOM("#toProjectWrap");
$("#remarksDetails").val('Received from ' + $("#paytoNameTxt").val());

} else {
if (!row.project) {
    return
}

row.to_branch_id = row.to_branch;
row.recon_code_id = row.recon_code_id;

voucher.showDOM("#updateGridVoucherDetails", "#deleteGridVoucherDetails");
voucher.hideDOM("#addToGridVoucherDetails");
voucher.projectDropDown('#projectName', row.project, $('#programType').val(), 'projects', $('#branchId').val(), 'Select Project', employeeId, false);
voucher.accountCodeDropDown('#chartOfAccounts', row.coa_id, row.project, 'Select A/C Code', false, {row: row});
$("#accountName").val(row.coa_name);
omitCAHOForNonOverHead(row.project, row.coa_id);
if (row.entity_id) {
    voucher.entityDropDown('#entityId', row.entity_id, row.project, 'Select Entity', false);
    voucher.showDOM("#entityDiv");
}
if (row.sl_id) {
    voucher.accountSubCodeDropDown('#subLedger', row.sl_id, row.project, row.coa_id, 'Select A/C Sub-Code', false);
    voucher.showDOM("#subLedgerWrap");
}

if (row.to_branch_id) {
    voucher.branchDropDownEnterprise('#toBranch', row.to_branch_id, 'To Branch', '1,5', false);
    voucher.showDOM("#toBranchWrap");
}
if (row.to_project_id) {
    toProjectFlag = true;
    voucher.projectDropDown('#toProject', row.to_project_id, null, 'projects', row.to_branch_id, 'Select To Project', null, false, {row: row});
    voucher.showDOM("#toProjectWrap");
}

if ((objSB && objSB.isOverhead) || overHeadFlag) {
    $('#toBranch').select2("readonly", false);
    $('#toProject').select2("readonly", false);
} else {
    $('#toBranch').select2("readonly", true);
    $("#toProject").attr("readonly", true);
}

if (row.recon_code_id) {

    accReconCodeListWithCriteria = null;
    if(currentBranchOverHeadProject && currentBranchOverHeadProject.id.toString() === row.project.toString()){
        accReconCodeListWithCriteria = accReconCodeListWithCriteriaTransfer;
        voucher.reconCodeDropDownWithCriteria('#reconCode', null, "Select ReconCode", null, true, null);
    }
    else{
        accReconCodeListWithCriteria = accReconCodeListWithCriteriaReceive;
        voucher.reconCodeDropDownWithCriteria('#reconCode', null, "Select ReconCode", null, null, true);
    }

    $('#reconCode').val(row.recon_code_id).trigger("change");
    voucher.showDOM("#reconCodeWrap");
}

if (row.areaCode) {
    $("#areaCode").val(row.areaCode);
    voucher.showDOM("#warp_areaCode");
    if (!$('#areaCode').is('[readonly]')) {
        hasAreaCode(row.to_branch_id, row.to_project_id)
    }
}

if (row.amount_in_words) {
    $("#amount").val(row.amount_in_words);
} else {
    changeNumberToText(row.debit);
}

$("#debit").val(row.debit);
$("#remarksp").val(row.remarks);

if ($('#entityId option').length > 1) {
    voucher.showDOM("#entityDiv");
} else {
    voucher.hideDOM("#entityDiv");
}
}
if (objSB && objSB.debitVoucherList.status === 'Approved') {
voucher.hideDOM("#saveOptions", "#detailsButton", "#mobileButtons", "#bankButtons");
voucher.readOnly("#paytoType", "#paymentType", "#paymentSubType", "#bankAccount", "#mobilePaymentSubType",
    "#projectName", "#chartOfAccounts", "#subLedger", "#entityId", "#reconCode", "#toBranch", "#toProject");
}

}

function hasAreaCode(officeId, projectId) {
var params = "officeId=" + officeId + "&projectId=" + projectId;
$.ajax({
url: '/node/accJournalMaster/getAreaCodeByOfficeAndProject',
type: 'GET',
data: params,
dataType: 'json',
success: function (data) {
    if (data.areaCode) {
        $("#areaCode").prop("readonly", true);
    } else {
        $("#areaCode").prop("readonly", false);
    }
}, error: function (x, e) {
    onAjaxError(x, e);
}
});
}

function programTypeChange() {
var response = voucher.getAjaxResponse('costCenter/getCostCenterListAndProjectByOrganization',
{
    programType: $("#programType").val()
}, false
);
currentBranchOverHeadProject = response.overHeadProj;
initGridItems();
}

function initBankGridItems(row) {

if(row){
if (!row.paymentsubtypeid) {
    return
}
}

voucher.showDOM("#bank_details");
voucher.hideDOM("#cashSection", "#cashAmountWordSection", "#mobilePaymentDetailsDiv");
voucher.hideDOM("#updateGridPaymentDetails", "#deleteGridPaymentDetails");
voucher.showDOM("#addToGridPaymentDetails");
paymentRowId = null;

if (!row) {

voucher.initializeSelect2ElementWithValue({'#bankAccount': ''});
$("#checkAmount, #checkNo, #checkDate, #remarks").val('');
voucher.paymentSubTypeDropDown('#paymentSubType', null, PAYMENT_BANK_CODE, ['BEFTN'], 'Select Payment Sub Type');
voucher.bankAccountDropDown("#bankAccount", null, MENU_URL, $("#programType").val(), 'Select Bank Account');
$('.cheque-date-picker').datepicker("setDate", '');

} else {
if (!row.paymentsubtypeid) {
    return
}
voucher.hideDOM("#addToGridPaymentDetails");
voucher.showDOM("#updateGridPaymentDetails", "#deleteGridPaymentDetails");

if (row.paymentsubtypeid) {
    voucher.paymentSubTypeDropDown('#paymentSubType', row.paymentsubtype, PAYMENT_BANK_CODE, ['BEFTN'], 'Select Payment Sub Type', false);
}

if (row.bankaccountid) {
    $("#bankAccount").val(row.bankaccountid);
}

$("#checkNo").val(row.checkno);
$("#checkDate").val(row.checkdate);
$("#checkAmount").val(row.checkamount);
$("#remarks").val(row.remarks);
}
}

function initMobileGridItems(row) {

if(row){
if (!row.acc_payment_sub_type_id) {
    return
}
}

voucher.hideDOM("#bank_details", "#cashSection", "#cashAmountWordSection");
voucher.showDOM("#mobilePaymentDetailsDiv");
voucher.showDOM("#addToMobileDetailsGrid");
voucher.paymentSubTypeDropDown('#paymentSubType', null, PAYMENT_BANK_CODE, ['BEFTN'], 'Select Payment Sub Type');
voucher.hideDOM("#mobileDelete", "#mobileUpdate");

if (!row) {

voucher.initializeSelect2ElementWithValue({'#mobilePaymentSubType': ''});
voucher.initializeElementWithValue({
    '#mobileDetailsId': '',
    '#mobileNumber': '',
    '#mobileRemarks': '',
    '#mobileAmount': '',
    '#mobileTransactionNo': '',
    '#mobileTransactionDate': ''
});

$('.date-picker').datepicker("setDate", '');

} else {

if (!row.acc_payment_sub_type_id) {
    return
}
voucher.hideDOM("#addToMobileDetailsGrid");
voucher.showDOM("#mobileDelete", "#mobileUpdate");

if (row.acc_payment_sub_type_id) {
    voucher.paymentSubTypeDropDown('#mobilePaymentSubType', row.paymentsubtype, PAYMENT_MOBILE_CODE, null, 'Select Payment Sub Type', false);
}

$("#mobileNumber").val(row.mobile_number);
$("#mobileAmount").val(row.mobile_amount);
$("#mobileTransactionNo").val(row.mobile_transaction_no);
$("#mobileTransactionDate").val(row.mobile_transaction_date);
$("#mobileRemarks").val(row.mobile_remarks);

}
}

function projectChange() {
voucher.hideDOM("#toBranchWrap", "#toProjectWrap", "#reconCodeWrap", "#warp_areaCode", "#entityDiv", "#subLedgerWrap");
$("#debit,  #amount, #accountName").val('');
var response = voucher.accountCodeDropDown('#chartOfAccounts', null, $('#projectName').val(), 'Select A/C Code', false);
overHeadFlag = response.isOverhead;

voucher.entityDropDown('#entityId', null, $('#projectName').val(), 'Select Entity', false);
if ($('#entityId option').length > 1) {
voucher.showDOM("#entityDiv");
} else {
voucher.hideDOM("#entityDiv");
}

voucher.selectMenuInitializeWithDefault({
'#subLedger': 'Select A/C SubCode'
});
voucher.hideDOM("#subLedgerWrap");

checkAndshowToBranchAndToProject(
$("#programType").val(), '#projectNameWrap', '#chartOfAccountsWrap', '#accountName', '#subLedgerWrap',
'#toBranchWrap', '#toProjectWrap', '#reconCodeWrap', '#entityDiv',

'#projectName', '#chartOfAccounts', '#accountName', '#subLedger', '#toBranch',
'#toProject', '#reconCode', '#entityId',
'1,5'
);
}

function checkAndshowToBranchAndToProject(
programType,
divProject,
divACCode,
fieldACCodeName,
divACSubCode,
divToBranch,
divToProject,
divReconCode,
divEntity,
fieldProjectId,
fieldChartOfAccountsId,
fieldChartOfAccountsName,
fieldSubCodeId,
fieldToBranchId,
fieldToProjectId,
fieldReconCodeId,
fieldEntityId,
officeTypeIdsStr,
featureName,
params
) {
voucher.hideDOM(divToBranch, divToProject, divReconCode);
var project_id = $(fieldProjectId).val();
var chartOfAccountsId = $(fieldChartOfAccountsId).val();
var flagRemoveCAHO = false;
if (project_id && project_id.toString() !== currentBranchOverHeadProject.id.toString()) {
flagRemoveCAHO = true;
}
if (project_id) {
var projectCoa = voucher.getAjaxResponse('accJournalMaster/getAccountHeadExceptCashBankByProject',
    {
        projectId: project_id
    },
    false
);

var overhead_coa_type = null;
$.each(projectCoa.accHead, function (i, val) {

    if (val.id.toString() === chartOfAccountsId.toString()) {
        overhead_coa_type = val.overhead_coa_type;
        $(fieldACCodeName).val(val.chart_of_account_name);
    }
    if (flagRemoveCAHO === true && val.overhead_coa_type === 'CAHO' && featureName !== 'JournalVoucher') {
        $(fieldChartOfAccountsId + " option[value='" + val.id + "']").remove();
    }
    if (flagRemoveCAHO === false && val.overhead_coa_type === 'CAHO'){
        cahoId = val.id;
    }
});

var defaultBranch = $('#branchId').val();
var defaultReconCode = null;
if (params && params.row) {
    defaultBranch = params.row.to_branch_id;
    defaultReconCode = params.row.recon_code_id;
    $("#areaCode").val(params.row.areaCode);
}
if (chartOfAccountsId && overhead_coa_type && overhead_coa_type.toString() === 'CAHO' && project_id && project_id.toString() === currentBranchOverHeadProject.id.toString()) {
    accReconCodeListWithCriteria = accReconCodeListWithCriteriaTransfer;
    voucher.reconCodeDropDownWithCriteria(fieldReconCodeId, defaultReconCode, "Select ReconCode", null, true, null);
    voucher.showDOM(divToBranch, divToProject, divReconCode, "#warp_areaCode");
    defaultBranch = '2'
    defaultBranch = ''
    voucher.branchDropDownEnterprise(fieldToBranchId, defaultBranch, 'To Branch', officeTypeIdsStr, false);
    // $(fieldToBranchId).select2("readonly", true);
    voucher.projectDropDown(fieldToProjectId, currentBranchOverHeadProject.id.toString(), null, 'projects', defaultBranch, 'Select To Project', null, false);
    $(fieldToProjectId).select2("readonly", false);

} else if (featureName !== 'JournalVoucher' && project_id && project_id.toString() !== currentBranchOverHeadProject.id.toString()) {
    accReconCodeListWithCriteria = accReconCodeListWithCriteriaReceive;
    voucher.reconCodeDropDownWithCriteria(fieldReconCodeId, defaultReconCode, "Select ReconCode", null, null, true);
    voucher.showDOM(divToBranch, divToProject, divReconCode, "#warp_areaCode");
    voucher.branchDropDownEnterprise(fieldToBranchId, defaultBranch, 'To Branch', officeTypeIdsStr, false);
    // $(fieldToBranchId).select2("readonly", true);
    voucher.projectDropDown(fieldToProjectId, currentBranchOverHeadProject.id.toString(), null, 'projects', defaultBranch, 'Select To Project', null, false);
    voucher.readOnly(fieldToProjectId);
    $(fieldToProjectId).select2("readonly", true);
} else {
    accReconCodeListWithCriteria = null;
    voucher.hideDOM(divToBranch, divToProject, divReconCode, "#warp_areaCode");
}
}

if ($(fieldEntityId + ' option').length > 1) {
voucher.showDOM(divEntity);
} else {
voucher.hideDOM(divEntity);
}

if($('#chartOfAccounts').val() == cahoId){
makeCahoParticular('','')
}else{
$("#remarksp").val('Paid to ' + $('#paytoNameTxt').val() + ' against');
}

}

function chartOfAccountsChange() {

voucher.accountSubCodeDropDown('#subLedger', null, $('#projectName').val(), $('#chartOfAccounts').val(), 'Select A/C Sub-Code', false);
if ($('#subLedger option').length > 1) {
voucher.showDOM("#subLedgerWrap");
} else {
voucher.hideDOM("#subLedgerWrap");
}

checkAndshowToBranchAndToProject(
$("#programType").val(), '#projectNameWrap', '#chartOfAccountsWrap', '#accountName', '#subLedgerWrap',
'#toBranchWrap', '#toProjectWrap', '#reconCodeWrap', '#entityDiv',

'#projectName', '#chartOfAccounts', '#accountName', '#subLedger', '#toBranch',
'#toProject', '#reconCode', '#entityId',
'1,5'
);
}

function toBranchChange() {
voucher.hideDOM("#toProjectWrap");
if ($('#toBranch').select2('data') && $('#toBranch').select2('data').id) {
voucher.projectDropDown('#toProject', null, null, 'projects', $('#toBranch').select2('data').id, "Select From Project", null, false);
if ($('#toProject option').length > 1) {
    voucher.showDOM("#toProjectWrap");
} else {
    voucher.hideDOM("#toProjectWrap");
}
}

if($('#chartOfAccounts').val() == cahoId){
makeCahoParticular($("#toBranch").select2('data').name,'');
}
}

function omitCAHOForNonOverHead(projectId, coaId) {
var projectCoa = voucher.getAjaxResponse('accJournalMaster/getAccountHeadExceptCashBankByProject',
{
    projectId: projectId
},
false
);
var flagRemoveCAHO = false;
if (projectId && projectId.toString() !== currentBranchOverHeadProject.id.toString()) {
flagRemoveCAHO = true;
}
var overhead_coa_type = null;
$.each(projectCoa.accHead, function (i, val) {
if (val.id.toString() === coaId.toString()) {
    overhead_coa_type = val.overhead_coa_type;
    $("#accountName").val(val.chart_of_account_name);
}
if (flagRemoveCAHO === true && val.overhead_coa_type === 'CAHO') {
    $("#chartOfAccounts option[value='" + val.id + "']").remove();
}
});
}

function makeCahoParticular(toBranch, toProject){
if(!toProject){
toProject = ''
}
if(!toBranch){
toBranch = ''
}

var particulars = "Transfer to Project " + toProject + ", Branch " + toBranch;
$("#remarksp").val(particulars);
}


</script>


<title>Debit Voucher</title>

<div class="portlet box panel panel-default">
<div class="panel-heading custom-panel-header">
<div class="panel-title">
<div class="caption"><i class="fa fa-file-text-o"></i>
    <span id="debitTitle">Create Debit Voucher</span>
    <a class="btn-sm pull-right" href="#accJournalMaster/debitList" onclick="loadUrl('accJournalMaster/debitList')" id="createNew">
        <i class="fa fa-arrow-left"></i> Back</a>
</div>
</div>
</div>

<div class="panel-body">
<form id="issueDebitVoucherForm" name="issueDebitVoucherForm" class="form-horizontal" enctype="multipart/form-data" method="post">
<div class="row">
    <div id="voucher">
        <div class="col-md-6 ">
            <input type="hidden" class="form-control" name="menuUrl" id="menuUrl" value="accJournalMaster/showIssueDebitVoucher">

            <div class="form-group">
                <label class=" col-md-5">Voucher No:</label>
                <input type="text" name="voucher_no" id="voucher_no" class="col-md-7 input-field-control" readonly="readonly" placeholder="Auto Generated">
            </div>

            <div class="form-group">
                <label class="col-md-5">Category: <span class="mandatoryfield">*</span></label>
                <div class="select2-container col-md-7 dropdown-input-field-control" id="s2id_programType"><a href="javascript:void(0)" class="select2-choice" tabindex="-1">   <span class="select2-chosen" id="select2-chosen-11">Microfinance (C002)</span><abbr class="select2-search-choice-close"></abbr>   <span class="select2-arrow" role="presentation"><b role="presentation"></b></span></a><label for="s2id_autogen11" class="select2-offscreen"></label><input class="select2-focusser select2-offscreen" type="text" aria-haspopup="true" role="button" aria-labelledby="select2-chosen-11" id="s2id_autogen11"><div class="select2-drop select2-display-none select2-with-searchbox">   <div class="select2-search">       <label for="s2id_autogen11_search" class="select2-offscreen"></label>       <input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="select2-input" role="combobox" aria-expanded="true" aria-autocomplete="list" aria-owns="select2-results-11" id="s2id_autogen11_search" placeholder="">   </div>   <ul class="select2-results" role="listbox" id="select2-results-11">   </ul></div></div><select name="programType" class="col-md-7 dropdown-input-field-control select2-offscreen" id="programType" onchange="programTypeChange()" tabindex="-1" title=""><option value="">-Select Category-</option><option value="C001">Non-Microfinance (C001)</option><option value="C002">Microfinance (C002)</option><option value="ENT">Enterprise (ENT)</option></select>
            </div>

            <div class="form-group">
                <label class=" col-md-5">Description:<span class="mandatoryfield">*</span></label>
                <input type="text" class="col-md-7 input-field-control" name="description" id="description" placeholder="Description" tabindex="1" maxlength="500">
            </div>

            <div class="form-group">
                <label class=" col-md-5">PayTo(Type): <span class="mandatoryfield">*</span>
                </label>
                <select id="paytoType" name="paytoType" class="dropdown-input-field-control">
                    <option value="other">Other</option>
                </select>
            </div>

            <div class="form-group block">
                <label class="col-md-5">Attach file: <a title="Maximum file size is 5MB and file formats can be 'pdf,doc,docx,xls,csv'">
                    <i class="fa fa-info-circle" aria-hidden="true"></i>
                </a>
                </label>
                <input type="file" name="attachment" id="attachment" onchange="loadFileDocument(event)">
                <label id="fileName"></label>

            </div>

            <div class="form-group hidden-col">
                <label class=" col-md-5">Debit Note:
                </label>
                <input type="checkbox" name="isDebitNote" id="isDebitNote" checked="checked" style="width:20px;">
            </div>
        </div>

        <div class="col-md-6">
            <div class="form-group">
                <label class=" col-md-5">Date: <span class="mandatoryfield">*</span></label>
                <input type="text" id="dateOfCreation" name="dateOfCreation" tabindex="2" placeholder="dd/mm/yyyy" class="input-field-control validate[required] datepicker" readonly="readonly">
            </div>

            <div class="form-group">
                <label class=" col-md-5">Ref:</label>
                <input type="text" name="ref" id="ref" maxlength="250" placeholder="Ref" tabindex="4" value="" class="col-md-7 input-field-control">
            </div>

            <div class="form-group">
                <label class=" col-md-5">PayTo(Name): <span class="mandatoryfield">*</span>
                </label>

                <input type="text" name="paytoNameTxt" id="paytoNameTxt" onkeyup="addParticular(this.value)" tabindex="5" maxlength="250" placeholder="Name" class="col-md-7 input-field-control">
            </div>

            <div class="form-group">
                <label class=" col-md-5">Payment Type: <span class="mandatoryfield">*</span></label>
                <select name="paymentType" class="dropdown-input-field-control" id="paymentType">
<option value="">-Select Payment Type-</option>
<option value="CASH">Cash</option>
<option value="BANK">Bank</option>
<option value="MOBILE_BANKING" disabled="disabled">Mobile Banking</option>
</select>
            </div>

            <div class="form-group" id="cashSection">
                <label class=" col-md-5">Cash Amount: <span class="mandatoryfield">*</span></label>
                <input type="text" name="cashAmount" id="cashAmount" maxlength="15" placeholder="Eg 10000 etc" tabindex="7" class="col-md-7 input-field-control pastedString" onkeyup="changeCashAmountToText(this.value)" onkeypress="return validateFloatKeyPress(this, event);">
            </div>

            <div class="form-group" id="cashAmountWordSection">
                <label class=" col-md-5">Cash Amount(In words): <span class="mandatoryfield">*</span>
                </label>
                <input type="text" class="col-md-7 input-field-control" name="cashAmountWord" id="cashAmountWord" placeholder="Amount in Words" readonly="readonly">
            </div>

        </div>
    </div>
</div>
<input type="hidden" name="rowId" id="rowId">

<input type="hidden" name="totalChequeAmount" maxlength="20" id="totalChequeAmount">

<div id="bank_details">
    <div class="row">
        <legend class="panel-body" style="font-size: 15px !important;"><b>Payment Details</b>
        </legend>

        <div class="col-md-6 ">
            <div class="form-group">
                <label class="col-md-5">Payment Sub Type: <span class="mandatoryfield">*</span>
                </label>
                <select id="paymentSubType" name="paymentSubType" class="dropdown-input-field-control">
                </select>
            </div>

            <div class="form-group">
                <label class=" col-md-5">Bank Account: <span class="mandatoryfield">*</span></label>
                <select id="bankAccount" name="bankAccount" class="dropdown-input-field-control">
                </select>
            </div>

        </div>

        <div class="col-md-6">
            <div class="form-group">
                <label class=" col-md-5">Amount: <span class="mandatoryfield">*</span>
                </label>
                <input type="text" class="pastedString col-md-7 input-field-control" name="checkAmount" maxlength="15" tabindex="7" onkeypress="return validateFloatKeyPress(this, event);" placeholder="Eg. 1000000 etc." id="checkAmount">
            </div>

            <div class="form-group" id="transactionNoDiv">
                <label class=" col-md-5" id="transNo">Transaction No: <span class="mandatoryfield">*</span>
                </label>
                <input type="text" class="col-md-7 input-field-control" maxlength="20" name="checkNo" placeholder="E.g. 789545 etc." tabindex="8" id="checkNo">
            </div>

            <div class="form-group">
                <label class=" col-md-5" id="transDate">Transaction Date: <span class="mandatoryfield">*</span></label>

                <div class="input-group input-medium date cheque-date-picker col-md-7" data-date-format="dd/mm/yyyy">
                    <input type="text" id="checkDate" name="checkDate" placeholder="dd/mm/yyyy" class="date-input-field-control" tabindex="9" readonly="">
                    <span class="input-group-btn">
                        <button class="btn default date-image-control" type="button"><i class="fa fa-calendar"></i></button>
                    </span>
                </div>
            </div>

            <div class="form-group">
                <label class=" col-md-5">Particulars: <span class="mandatoryfield"></span>
                </label>
                <input type="text" class="col-md-7 input-field-control" name="remarks" id="remarks" placeholder="Particulars" tabindex="10" maxlength="500">
            </div>

            <div class="form-group" id="bankButtons">
                <div class="pull-right" style="margin-right: 50px">
                    <button id="addToGridPaymentDetails" name="create" type="button" class="btn btn-sm purple"><i class="fa fa-plus-square"></i>  Add
                    </button>

                    <button id="updateGridPaymentDetails" name="create" type="button" class="btn btn-sm purple"><i class="fa fa-plus-square"></i>  Update
                    </button>
                    <button id="deleteGridPaymentDetails" name="delete" type="button" class="btn btn-sm red-soft"><i class="fa fa-trash-o"></i>  Delete
                    </button>
                    <button id="resetDetails" name="create" type="button" class="btn btn-sm green"><i class="fa fa-refresh"></i>  Reset
                    </button>

                </div>
            </div>
        </div>
    </div>

    <div class="portlet box panel panel-default" id="bankDetails">
        <div class="portlet-title">
            <div class="caption"><i class="fa fa-list"></i> Bank Details
            </div>
        </div>

        <div class="panel-body">
            <table id="paymentDetailTable" class="table table-bordered table-striped table-condensed">
            </table>
        </div>

    </div>

</div>




<div id="mobilePaymentDetailsDiv" style="display: none;">
    <div class="row">
        <div class="panel-body">
            <legend class="panel-body pull-left" style="font-size: 15px !important;"><b>Payment Details</b>
            </legend>
            <input type="hidden" name="mobileDetailsId" id="mobileDetailsId">

            <div class="col-md-12">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="col-md-5" for="mobilePaymentSubType">Payment Sub Type: <span class="mandatoryfield">*</span>
                        </label>
                        <select id="mobilePaymentSubType" name="mobilePaymentSubType" class="col-md-7 dropdown-input-field-control">
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="col-md-5" for="mobileNumber">Mobile No: <span class="mandatoryfield">*</span>
                        </label>

                        <input type="text" id="mobileNumber" name="mobileNumber" placeholder="Mobile No" tabindex="11" onkeypress=" return checkMobileNumberPattern(event)" maxlength="20" class="col-md-7 input-field-control">
                    </div>

                    <div class="form-group">
                        <label class="col-md-5" for="mobileRemarks">Particulars:
                        </label>

                        <input type="text" id="mobileRemarks" name="mobileRemarks" placeholder="Particulars" maxlength="250" tabindex="12" class="col-md-7 input-field-control">
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label class="col-md-5" for="mobileAmount">Amount: <span class="mandatoryfield">*</span>
                        </label>

                        <input type="text" id="mobileAmount" name="mobileAmount" placeholder="Amount" min="0" tabindex="13" onkeypress=" return validateFloatKeyPress(this, event)" maxlength="15" class="col-md-7 input-field-control pastedString">
                    </div>

                    <div class="form-group">
                        <label class="col-md-5" for="mobileTransactionNo" id="mobileTransNo">Transaction No: <span class="mandatoryfield">*</span>
                        </label>

                        <input type="text" id="mobileTransactionNo" name="mobileTransactionNo" placeholder="e.g. 123456" maxlength="50" tabindex="14" class="col-md-7 input-field-control pastedString">
                    </div>

                    <div class="form-group">
                        <label class="col-md-5" for="mobileTransactionDate" id="mobileTransDate" \="">Transaction Date: <span class="mandatoryfield">*</span>
                        </label>

                        <div class="input-group input-medium date date-picker col-md-7" data-date-format="dd/mm/yyyy">
                            <input type="text" id="mobileTransactionDate" name="mobileTransactionDate" placeholder="dd/mm/yyyy" tabindex="15" class="date-input-field-control" readonly="">
                            <span class="input-group-btn">
                                <button class="btn default date-image-control" type="button"><i class="fa fa-calendar"></i></button>
                            </span>
                        </div>
                    </div>

                    <div class="form-group" id="mobileButtons">
                        <div class="pull-right" style="margin-right: 50px">
                            <button id="addToMobileDetailsGrid" name="addToMobileDetailsGrid" type="button" class="btn btn-sm purple"><i class="fa fa-plus-square"></i>  Add
                            </button>
                            <button id="mobileUpdate" type="button" class="btn btn-sm purple"><i class="fa fa-plus-square"></i> Update
                            </button>
                            <button id="mobileDelete" type="button" class="btn btn-sm red-soft"><i class="fa fa-trash-o"></i> Delete
                            </button>
                            <button type="button" id="resetMobileDetail" class="btn btn-sm green"><i class="fa fa-refresh"></i> Reset
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="panel-body" id="mobilePaymentDetailsGridDiv">
        <div class="portlet box panel panel-default">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-list"></i> List Payment Details
                </div>
            </div>

            <div class="portlet-body" id="portlet-body-mobile_payment-details">
                <table class="table table-striped table-bordered table-hover" id="mobilePaymentDetailsGrid">
                </table>
            </div>
        </div>
    </div>
</div>



<div class="row">
    <div id="voucher-details">
        <legend class="panel-body pull-left" style="font-size: 15px !important;"><b>Debit Voucher Details</b>
        </legend>

        <div class="panel-body">
            <div class="col-md-6">
                <div class="form-group" id="projectNameWrap">
                    <label class=" col-md-5">Project: <span class="mandatoryfield">*</span>
                    </label>
                    <div class="select2-container dropdown-input-field-control" id="s2id_projectName"><a href="javascript:void(0)" class="select2-choice" tabindex="-1">   <span class="select2-chosen" id="select2-chosen-12">-Select Project-</span><abbr class="select2-search-choice-close"></abbr>   <span class="select2-arrow" role="presentation"><b role="presentation"></b></span></a><label for="s2id_autogen12" class="select2-offscreen"></label><input class="select2-focusser select2-offscreen" type="text" aria-haspopup="true" role="button" aria-labelledby="select2-chosen-12" id="s2id_autogen12"><div class="select2-drop select2-display-none select2-with-searchbox">   <div class="select2-search">       <label for="s2id_autogen12_search" class="select2-offscreen"></label>       <input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="select2-input" role="combobox" aria-expanded="true" aria-autocomplete="list" aria-owns="select2-results-12" id="s2id_autogen12_search" placeholder="">   </div>   <ul class="select2-results" role="listbox" id="select2-results-12">   </ul></div></div><select id="projectName" name="projectName" onchange="projectChange();" class="dropdown-input-field-control select2-offscreen" tabindex="-1" title=""><option value="">-Select Project-</option></select>
                </div>


                <div class="form-group" id="chartOfAccountsWrap">
                    <label class=" col-md-5">A/C Code: <span class="mandatoryfield">*</span></label>
                    <select id="chartOfAccounts" name="chartOfAccounts" onclick="chartOfAccountsChange();" class="dropdown-input-field-control">
                    </select>
                </div>

                <div class="form-group">
                    <label class=" col-md-5">A/C Name:</label>

                    <input type="text" name="accountName" id="accountName" placeholder="A/C Name" class="col-md-7 input-field-control" readonly="readonly">
                </div>

                <div class="form-group" id="subLedgerWrap" style="display: none;">
                    <label class=" col-md-5">A/C Sub-Code: <span class="mandatoryfield">*</span></label>
                    <select id="subLedger" name="subLedger" class="dropdown-input-field-control">
                    </select>
                </div>


                <div class="form-group" id="entityDiv" style="display: none;">
                    <label class=" col-md-5">Entity:
                    </label>
                    <select id="entityId" name="entity_id" class="dropdown-input-field-control">
                    </select>
                </div>


                <div class="form-group " id="reconCodeWrap" style="display: none;">
                    <label class=" col-md-5">ReconCode: <span class="mandatoryfield">*</span></label>
                    <select id="reconCode" name="reconCode" onchange="reconCodeDropDownOnChanges(this.id)" class="dropdown-input-field-control">
                    </select>
                </div>

                <div class="form-group" id="toBranchWrap" style="display: none;">
                    <label class=" col-md-5">To Branch <span class="mandatoryfield">*</span></label>
                    <input id="toBranch" name="toBranch" onclick="toBranchChange();" class="col-md-7 dropdown-input-field-control">
                </div>

                <div class="form-group" id="toProjectWrap" style="display: none;">
                    <label class=" col-md-5">To Project: <span class="mandatoryfield">*</span>
                    </label>
                    <select id="toProject" name="toProject" class="dropdown-input-field-control">
                    </select>
                </div>

            </div>

            <div class="col-md-6">

                <div class="form-group" id="warp_areaCode" style="display: none;">
                    <label class=" col-md-5">Area Code: <span class="mandatoryfield">*</span></label>
                    <input type="text" min="0" class="pastedString input-field-control" name="areaCode" id="areaCode" maxlength="9" readonly="" onkeypress="return validateFloatKeyPress(this, event);">
                </div>

                <div class="form-group">
                    <label class=" col-md-5">Amount(Dr.): <span class="mandatoryfield">*</span>
                    </label>

                    <input type="text" class="pastedString col-md-7 input-field-control" maxlength="15" onkeypress="return validateFloatKeyPress(this, event);" placeholder="Eg. 1000000." tabindex="16" name="debit" id="debit" onkeyup="changeNumberToText(this.value)">
                </div>

                <div class="form-group">
                    <label class=" col-md-5">Amount(In words): <span class="mandatoryfield">*</span>
                    </label>

                    <input type="text" class="col-md-7 input-field-control" name="amount" id="amount" placeholder="Amount in Words" readonly="readonly">
                </div>


                <div class="form-group">
                    <label class=" col-md-5">Particulars: <span class="mandatoryfield">*</span></label>




                    <textarea type="text" min="0" class="form-control" name="remarksp" id="remarksp" rows="4" placeholder="Particulars" maxlength="250"></textarea>
                </div>

                <div class="form-group">
                    <input type="hidden" class="form-control " name="total" id="total">
                    <input type="hidden" class="form-control " name="totalcredit" id="totalcredit">
                </div>

            </div>

            <div class="form-group" id="detailsButton">
                <div class="pull-right" style="margin-right: 50px">
                    <button id="addToGridVoucherDetails" name="create" type="button" class="btn btn-sm purple"><i class="fa fa-plus-square"></i>  Add
                    </button>
                    <button id="updateGridVoucherDetails" name="create" type="button" class="btn btn-sm purple" style="display: none;"><i class="fa fa-plus-square"></i>  Update
                    </button>
                    <button id="deleteGridVoucherDetails" type="button" class="btn btn-sm red-soft" style="display: none;"><i class="fa fa-trash-o"></i> Delete
                    </button>
                    <button id="resetVoucherDetails" type="button" class="btn btn-sm green"><i class="fa fa-refresh"></i>  Reset
                    </button>
                </div>
            </div>

        </div>
    </div>

</div>


</form>

<div class="portlet box panel panel-default" id="debitVoucherDiv">
<div class="portlet-title">
    <div class="caption"><i class="fa fa-list"></i> Voucher Details</div>
</div>
<input type="hidden" name="fundControlId" id="fundControlId">
<input type="hidden" name="fundControlName" id="fundControlName">

<div class="panel-body">
    <table id="issuDebitVoucherDetailTable" class="table table-bordered table-striped table-condensed">
    </table>
</div>

</div>
</div>

<div class="panel-footer">
<div class="col-md-12"></div>

<div id="saveOptions">
<button id="save" name="post" type="button" class="btn btn btn-sm blue">
    <i class="fa fa-check"></i> Draft
</button>
<button id="saveUpdate" name="post" type="button" class="btn btn btn-sm blue"><i class="fa fa-check"></i> Update
</button>
<button id="submit" name="post" type="button" class="btn btn-sm yellow-gold">
    <i class="fa fa-hand-o-up"></i> Submit
</button>
<button id="delete" name="cancel" type="button" class="btn btn-sm red-soft"><i class="fa fa-trash-o"></i> Delete
</button>

<button id="resetDebitForm" name="clearFormButton" type="button" data-role="button" class="btn btn-sm green pull-right" role="button" tabindex="10" aria-disabled="false" onclick="resetForm();"><i class="fa fa-refresh"></i> Reset
</button>
</div>

</div>
</div>
















</div>
    </div>
</div>